---
title: "TransformationAge"
output: html_document
date: "2024-11-21"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Transformation Age

This script take .csv files as input and transform them into a new .csv file. The new file will have the same name as the input file with the suffix "_transformed" added to it. The goal of the script is to transform the data  into a format that is easier to work with. The script will perform the following transformations:

  - Remove columns that are not needed
  - Rename in a more readable way the columns
  - Reorganize the columns order in a more logical way
  - Remove the rows with missing values
  - Add a column with the total population for each city
  - Add a column with the proportion of each sex on the total effective (3 decimals)
  - Add a column with the proportion of each sex on each age group : 15-24y, 25-64y, 65+y (3 decimals)


## Input

``` {r printInput} 
# Load data from the input directory : /rawData/demographies/
# First file to be loaded : AgePopulation_2010.csv
path <- "../../rawData/demographies/"
fileName <- "AgePopulation_2010.csv"
inputFile <- paste0(path, fileName)
data <- read.csv(inputFile, sep = ";",header = TRUE, skip = 2) # skip 2 first lines that are not needed
head(data)

```

## Rename columns

The columns names are not very readable. Some even got the same name. We will rename them to make them more understandable.

``` {r renameRows}
# Rename the rows
colNames <- c("Code Commune", "Nom Commune",
              "Nb 80+", "Prop 80+", "Nb -25", "Nb 25-64", "Nb 65+",
              "Nb 75+", "Taux Nat 1999-2010", "Taux Mort 1999-2010", "Prop -15", "Prop -25", "Prop 25-64", "Prop 65+", "Prop 75+")
colnames(data) <- colNames
head(data)
``` 
## Remove unwanted columns

Some columns are not needed. We will remove them.

``` {r removeColumns}
# Remove the columns that are not needed
data <- data[, -c(3,4,8,11,15)]
head(data)

```

## Reorganize clomumns order

The columns are not in a logical order. We will reorganize them in a more logical way.

``` {r reorganizeColumns}
# Reorganize the columns from the names of the columns
newOrder <- c("Code Commune", "Nom Commune",
              "Nb -25", "Nb 25-64", "Nb 65+",
              "Prop -25", "Prop 25-64", "Prop 65+",
              "Taux Nat 1999-2010", "Taux Mort 1999-2010"
              )
data <- data[, newOrder]
head(data)

```
## Remove rows with missing values

Some rows have missing values. We will remove these rows and save the id and name of the cities with missing values in an other data frame.

``` {r removeMissingValues}
# Print the number of missing values ("N/A - résultat non disponible") in the columns 3 to 10 (the columns with numeric data)
sum(data$`Nb 25-64` == "N/A - résultat non disponible")
sum(data$`Prop 25-64` == "N/A - division par 0")

# Save the id and name of the cities with missing values
missingValuesCities <- data[data$`Nb 25-64` == "N/A - résultat non disponible", c("Code Commune", "Nom Commune")]
missingValuesCities <- rbind(missingValuesCities, data[data$`Prop 25-64` == "N/A - division par 0", c("Code Commune", "Nom Commune")])
missingValuesCities

# Remove the rows with the value "N/A - résultat non disponible" in the columns 3 to 10
data <- data[!data$`Nb 25-64` == "N/A - résultat non disponible",]
data <- data[!data$`Prop 25-64` == "N/A - division par 0",]

# Print again the number of NA values, should be 0
sum(data$`Nb 25-64` == "N/A - résultat non disponible")
sum(data$`Prop 25-64` == "N/A - division par 0")
```


## Convert the columns to numeric

The columns with numeric data are currently in character format. We will convert them to numeric.

``` {r convertToNumeric}
# Convert the columns to numeric except the first two columns
data[,3:10] <- sapply(data[,3:10], as.numeric)
head(data)
```  

## Export data 

We will export the transformed data to a new .csv file. The new file will have the same name as the input file but stored in the right folder.

``` {r exportData}
# Export the data to a new .csv file
path <- "../../cleanData/demographies/"
outputFile <- paste0(path, fileName)
write.table(data, outputFile, row.names = FALSE, sep = ";", col.names = TRUE, quote = FALSE)

```







